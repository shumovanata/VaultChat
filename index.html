<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; color: #fff; height: 100vh; overflow: hidden; }
        .chat-container { height: 100vh; display: flex; flex-direction: column; background: #000; }
        .header { background: linear-gradient(135deg, #0088cc 0%, #005f99 100%); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header-title { font-size: 18px; font-weight: 600; color: white; }
        .close-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: background 0.2s; }
        .close-btn:hover { background: rgba(255,255,255,0.3); }
        .messages-container { flex: 1; padding: 20px; overflow-y: auto; background: #111; }
        .message { margin-bottom: 15px; display: flex; flex-direction: column; }
        .message.me { align-items: flex-end; }     /* –¢–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî —Å–ø—Ä–∞–≤–∞ */
        .message.partner { align-items: flex-start; } /* –°–æ–æ–±—â–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞ ‚Äî —Å–ª–µ–≤–∞ */
        .message-bubble { max-width: 70%; padding: 10px 15px; border-radius: 18px; word-wrap: break-word; }
        .message.me .message-bubble { background: #0088cc; border-bottom-right-radius: 4px; color: white; }
        .message.partner .message-bubble { background: #333; border-bottom-left-radius: 4px; color: #fff; }
        .message-time { font-size: 12px; color: #888; margin-top: 5px; text-align: right; }
        .message.partner .message-time { text-align: left; }
        .input-container { padding: 15px 20px; background: #000; border-top: 1px solid #333; display: flex; gap: 10px; }
        .message-input { flex: 1; padding: 12px 16px; border: 1px solid #333; border-radius: 20px; background: #111; color: #fff; font-size: 16px; outline: none; }
        .message-input::placeholder { color: #888; }
        .send-btn { width: 44px; height: 44px; border: none; border-radius: 50%; background: #0088cc; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
        .send-btn:hover { background: #006699; }
        .send-btn:disabled { background: #333; cursor: not-allowed; opacity: 0.5; }
        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #888; text-align: center; }
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="header">
            <div class="header-title">üí¨ –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</div>
            <button class="close-btn" onclick="Telegram.WebApp.close()">√ó</button>
        </div>

        <div class="messages-container" id="messagesContainer">
            <div class="empty-state">
                <div class="empty-state-icon">üí¨</div>
                <p>–ù–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–µ–ø–∏—Å–∫—É —Å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</p>
                <p style="font-size: 14px; margin-top: 8px;">–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å</p>
            </div>
        </div>

        <div class="input-container">
            <input type="text" class="message-input" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
            <button class="send-btn" id="sendBtn" disabled>‚û§</button>
        </div>
    </div>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');

        let messages = [];

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑ localStorage
        function loadMessages() {
            const saved = localStorage.getItem('private_chat_messages');
            if (saved) {
                messages = JSON.parse(saved);
                renderMessages();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
        function saveMessages() {
            localStorage.setItem('private_chat_messages', JSON.stringify(messages));
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        function renderMessages() {
            messagesContainer.innerHTML = '';
            if (messages.length === 0) {
                messagesContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <p>–ù–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–µ–ø–∏—Å–∫—É —Å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</p>
                        <p style="font-size: 14px; margin-top: 8px;">–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å</p>
                    </div>`;
                return;
            }

            messages.forEach(msg => {
                const div = document.createElement('div');
                div.className = `message ${msg.type}`;  // me –∏–ª–∏ partner
                const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
                div.innerHTML = `
                    <div class="message-bubble">${msg.text}</div>
                    <div class="message-time">${time}</div>
                `;
                messagesContainer.appendChild(div);
            });

            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
            const myMessage = {
                text: text,
                type: 'me',
                timestamp: new Date().toISOString()
            };
            messages.push(myMessage);
            renderMessages();
            saveMessages();

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–æ—Ç—É (—á—Ç–æ–±—ã –æ–Ω —É–≤–µ–¥–æ–º–∏–ª –ø–∞—Ä—Ç–Ω—ë—Ä–∞)
            Telegram.WebApp.sendData(JSON.stringify({
                action: 'send_message',
                text: text
            }));

            messageInput.value = '';
            toggleSendButton();
        }

        // –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ Enter
        function handleEnter(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        }

        function toggleSendButton() {
            sendBtn.disabled = messageInput.value.trim() === '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadMessages();
        messageInput.addEventListener('input', toggleSendButton);
        messageInput.addEventListener('keypress', handleEnter);
        sendBtn.addEventListener('click', sendMessage);

        // –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–Ω–∏–∑—É Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        Telegram.WebApp.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å');
        Telegram.WebApp.MainButton.show();
        Telegram.WebApp.MainButton.onClick(sendMessage);

        toggleSendButton();
    </script>
</body>
</html>
